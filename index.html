<!doctype html>
<html lang="uk" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UA Coins — для друзів</title>
  <meta name="description" content="Простий сайт для друзів: реєстрація, вхід, баланс і пересилання коінів. Збереження в браузері + експорт/імпорт у файл."/>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='48' fill='%230ea5e9'/%3E%3Ctext x='50' y='60' font-size='54' text-anchor='middle' fill='white'%3E₴%3C/text%3E%3C/svg%3E" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ["Inter", "system-ui", "Segoe UI", "Roboto", "Arial", "sans-serif"] },
          keyframes: {
            shimmer: { '0%': { backgroundPosition: '200% 0' }, '100%': { backgroundPosition: '-200% 0' }},
          },
          animation: { shimmer: 'shimmer 3s linear infinite' },
        }
      }
    }
  </script>
  <style>
    .glass{ backdrop-filter: blur(10px); background: rgba(255,255,255,0.6);} 
  </style>
</head>
<body class="min-h-full bg-gradient-to-br from-sky-50 via-white to-indigo-50 text-slate-800">
  <div class="absolute inset-0 -z-10 overflow-hidden pointer-events-none select-none">
    <div class="absolute -top-24 -left-24 h-72 w-72 rounded-full bg-sky-200 blur-3xl opacity-50"></div>
    <div class="absolute top-1/3 -right-24 h-72 w-72 rounded-full bg-indigo-200 blur-3xl opacity-50"></div>
  </div>

  <header class="max-w-5xl mx-auto px-4 pt-8 pb-4 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <div class="h-10 w-10 rounded-2xl bg-gradient-to-br from-sky-400 to-indigo-500 shadow-lg grid place-items-center text-white text-xl font-bold">₴</div>
      <div>
        <h1 class="text-xl font-bold">UA Coins</h1>
        <p class="text-sm text-slate-500">Сайт для друзів: реєстрація, відправка коінів, баланс</p>
      </div>
    </div>
    <div id="navUser" class="text-sm text-slate-600"></div>
  </header>

  <main class="max-w-5xl mx-auto px-4 pb-24">
    <!-- Auth / Welcome Card -->
    <section id="authCard" class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="glass rounded-3xl shadow-xl p-6 md:p-8">
        <h2 class="text-2xl font-semibold mb-4">Вхід</h2>
        <form id="loginForm" class="space-y-3">
          <div>
            <label class="text-sm text-slate-600">Нікнейм</label>
            <input id="loginNick" class="w-full mt-1 rounded-xl border border-slate-200 p-3 focus:outline-none focus:ring-2 focus:ring-sky-400" placeholder="наприклад, halit" autocomplete="username" />
          </div>
          <div>
            <label class="text-sm text-slate-600">Пароль</label>
            <input id="loginPass" type="password" class="w-full mt-1 rounded-xl border border-slate-200 p-3 focus:outline-none focus:ring-2 focus:ring-sky-400" placeholder="••••••••" autocomplete="current-password" />
          </div>
          <button class="w-full rounded-xl bg-sky-500 hover:bg-sky-600 active:bg-sky-700 text-white font-medium py-3 shadow">Увійти</button>
        </form>
      </div>

      <div class="glass rounded-3xl shadow-xl p-6 md:p-8">
        <h2 class="text-2xl font-semibold mb-4">Реєстрація</h2>
        <form id="signupForm" class="space-y-3">
          <div>
            <label class="text-sm text-slate-600">Нікнейм</label>
            <input id="signupNick" class="w-full mt-1 rounded-xl border border-slate-200 p-3 focus:outline-none focus:ring-2 focus:ring-sky-400" placeholder="оберіть унікальний нік" autocomplete="username" />
          </div>
          <div>
            <label class="text-sm text-slate-600">Пароль</label>
            <input id="signupPass" type="password" class="w-full mt-1 rounded-xl border border-slate-200 p-3 focus:outline-none focus:ring-2 focus:ring-sky-400" placeholder="мінімум 6 символів" autocomplete="new-password" />
          </div>
          <button class="w-full rounded-xl bg-indigo-500 hover:bg-indigo-600 active:bg-indigo-700 text-white font-medium py-3 shadow">Зареєструватися</button>
          <p class="text-xs text-slate-500">Нові акаунти отримують стартові 100 коінів.</p>
        </form>
      </div>
    </section>

    <!-- Dashboard -->
    <section id="app" class="hidden space-y-6">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="glass rounded-3xl shadow-xl p-6 md:p-8">
          <h3 class="text-lg font-semibold mb-4">Ваш баланс</h3>
          <div class="text-4xl font-extrabold" id="balance">0</div>
          <p class="text-slate-500 mt-2 text-sm">₴UA — внутрішні ігрові монети. Це не реальні гроші.</p>
          <div class="mt-6 flex gap-2">
            <button id="logoutBtn" class="flex-1 rounded-xl border border-slate-300 py-2 hover:bg-white">Вийти</button>
            <button id="deleteAccBtn" class="flex-1 rounded-xl border border-rose-300 text-rose-600 py-2 hover:bg-rose-50">Видалити акаунт</button>
          </div>
        </div>

        <div class="glass rounded-3xl shadow-xl p-6 md:p-8 md:col-span-2">
          <h3 class="text-lg font-semibold mb-4">Відправити коіни</h3>
          <form id="sendForm" class="grid grid-cols-1 md:grid-cols-12 gap-3 items-end">
            <div class="md:col-span-5">
              <label class="text-sm text-slate-600">Кому (нік)</label>
              <input id="sendTo" class="w-full mt-1 rounded-xl border border-slate-200 p-3 focus:outline-none focus:ring-2 focus:ring-sky-400" placeholder="нік отримувача" />
            </div>
            <div class="md:col-span-3">
              <label class="text-sm text-slate-600">Сума</label>
              <input id="sendAmount" type="number" min="1" step="1" class="w-full mt-1 rounded-xl border border-slate-200 p-3 focus:outline-none focus:ring-2 focus:ring-sky-400" placeholder="10" />
            </div>
            <div class="md:col-span-4">
              <button class="w-full rounded-xl bg-emerald-500 hover:bg-emerald-600 active:bg-emerald-700 text-white font-medium py-3 shadow">Відправити</button>
            </div>
          </form>
          <p class="text-xs text-slate-500 mt-2">Відправляти може лише користувач, що увійшов у свій акаунт.</p>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="glass rounded-3xl shadow-xl p-6 md:p-8">
          <h3 class="text-lg font-semibold mb-4">Користувачі</h3>
          <ul id="usersList" class="space-y-2 text-sm"></ul>
        </div>
        <div class="glass rounded-3xl shadow-xl p-6 md:p-8 md:col-span-2">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold">Історія транзакцій</h3>
            <div class="flex gap-2">
              <button id="exportBtn" class="rounded-xl border border-slate-300 py-2 px-3 hover:bg-white text-sm">Експорт у файл</button>
              <label class="rounded-xl border border-slate-300 py-2 px-3 hover:bg-white text-sm cursor-pointer">
                Імпорт з файлу
                <input id="importFile" type="file" accept="application/json" class="hidden" />
              </label>
            </div>
          </div>
          <div class="overflow-auto rounded-2xl border border-slate-200">
            <table class="min-w-full text-sm">
              <thead class="bg-slate-50">
                <tr>
                  <th class="text-left p-3">Час</th>
                  <th class="text-left p-3">Від</th>
                  <th class="text-left p-3">Кому</th>
                  <th class="text-right p-3">Сума</th>
                </tr>
              </thead>
              <tbody id="txTable" class="divide-y divide-slate-100 bg-white"></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <section class="mt-10 text-xs text-slate-500">
      <p><strong>Примітка про збереження:</strong> у цій простій версії всі дані зберігаються в <em>локальному сховищі браузера</em> на вашому пристрої. Щоб мати загальне збереження для всіх друзів (онлайн-база), можна підключити Firebase / Supabase — я залишив гачки в коді (секція TODO) для швидкої інтеграції.</p>
    </section>
  </main>

  <footer class="max-w-5xl mx-auto px-4 pt-8 pb-12 text-center text-xs text-slate-500">
    Зроблено з ♥ для друзів. Це демо-версія без серверу.
  </footer>

  <script>
    // === Просте сховище (LocalStorage) ===
    const LS_KEYS = {
      USERS: 'ua_users', // { nick: { passHash, balance } }
      TX: 'ua_transactions', // [ {from, to, amount, ts} ]
      SESSION: 'ua_session' // { nick }
    };

    const START_BONUS = 100;

    const $ = (id) => document.getElementById(id);
    const fmt = (n) => new Intl.NumberFormat('uk-UA').format(n);
    const tsFmt = (ms) => new Date(ms).toLocaleString('uk-UA');

    // Crypto hash (SHA-256) для паролів
    async function sha256(text){
      const enc = new TextEncoder().encode(text);
      const hash = await crypto.subtle.digest('SHA-256', enc);
      return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2,'0')).join('');
    }

    function load(key, fallback){
      try { return JSON.parse(localStorage.getItem(key)) ?? fallback } catch { return fallback }
    }
    function save(key, value){ localStorage.setItem(key, JSON.stringify(value)); }

    function getUsers(){ return load(LS_KEYS.USERS, {}); }
    function setUsers(obj){ save(LS_KEYS.USERS, obj); }
    function getTx(){ return load(LS_KEYS.TX, []); }
    function setTx(arr){ save(LS_KEYS.TX, arr); }
    function getSession(){ return load(LS_KEYS.SESSION, null); }
    function setSession(s){ save(LS_KEYS.SESSION, s); }
    function clearSession(){ localStorage.removeItem(LS_KEYS.SESSION); }

    // UI state
    function showApp(yes){
      $('authCard').classList.toggle('hidden', yes);
      $('app').classList.toggle('hidden', !yes);
    }

    function renderUsers(){
      const users = getUsers();
      const list = $('usersList');
      list.innerHTML = '';
      Object.entries(users).forEach(([nick, u]) => {
        const li = document.createElement('li');
        li.className = 'flex items-center justify-between rounded-xl border border-slate-200 px-3 py-2 bg-white';
        li.innerHTML = `<span class="font-medium">${nick}</span><span class="text-slate-500">${fmt(u.balance)} ₴UA</span>`;
        list.appendChild(li);
      });
    }

    function renderBalance(){
      const s = getSession(); if(!s) return;
      const users = getUsers();
      const me = users[s.nick];
      $('balance').textContent = fmt(me?.balance ?? 0);
      $('navUser').textContent = `Увійшли як: ${s.nick}`;
    }

    function renderTx(){
      const tbody = $('txTable');
      const txs = getTx().slice().reverse();
      tbody.innerHTML = '';
      txs.forEach(t => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="p-3">${tsFmt(t.ts)}</td>
          <td class="p-3">${t.from}</td>
          <td class="p-3">${t.to}</td>
          <td class="p-3 text-right font-medium">${fmt(t.amount)} ₴UA</td>`;
        tbody.appendChild(tr);
      })
    }

    function toast(msg, ok=true){
      const div = document.createElement('div');
      div.className = `fixed left-1/2 -translate-x-1/2 top-4 z-50 px-4 py-2 rounded-xl shadow-xl text-sm ${ok? 'bg-emerald-500 text-white' : 'bg-rose-500 text-white'}`;
      div.textContent = msg;
      document.body.appendChild(div);
      setTimeout(() => div.remove(), 2200);
    }

    // === Auth ===
    $('signupForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const nick = $('signupNick').value.trim();
      const pass = $('signupPass').value;
      if(!nick || !pass || pass.length < 6){ toast('Введіть нік і пароль (мін. 6 символів)', false); return; }
      const users = getUsers();
      if(users[nick]){ toast('Такий нік вже існує', false); return; }
      const passHash = await sha256(pass);
      users[nick] = { passHash, balance: START_BONUS };
      setUsers(users);
      setSession({ nick });
      toast('Реєстрація успішна! Нараховано 100 ₴UA');
      showApp(true); renderBalance(); renderUsers(); renderTx();
    });

    $('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const nick = $('loginNick').value.trim();
      const pass = $('loginPass').value;
      const users = getUsers();
      if(!users[nick]){ toast('Користувача не знайдено', false); return; }
      const passHash = await sha256(pass);
      if(users[nick].passHash !== passHash){ toast('Невірний пароль', false); return; }
      setSession({ nick });
      toast('Вхід виконано');
      showApp(true); renderBalance(); renderUsers(); renderTx();
    });

    $('logoutBtn').addEventListener('click', () => { clearSession(); toast('Ви вийшли'); showApp(false); $('navUser').textContent = ''; });

    $('deleteAccBtn').addEventListener('click', () => {
      const s = getSession(); if(!s) return;
      if(!confirm('Справді видалити акаунт? Це незворотно.')) return;
      const users = getUsers();
      delete users[s.nick];
      setUsers(users);
      clearSession();
      toast('Акаунт видалено');
      showApp(false); $('navUser').textContent = ''; renderUsers(); renderTx();
    });

    // === Переказ ===
    $('sendForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const s = getSession();
      if(!s){ toast('Спершу увійдіть', false); return; }
      const to = $('sendTo').value.trim();
      const amount = Math.floor(Number($('sendAmount').value));
      if(!to || !Number.isFinite(amount) || amount <= 0){ toast('Некоректна сума або нік', false); return; }
      const users = getUsers();
      const from = s.nick;
      if(!users[to]){ toast('Отримувача не знайдено', false); return; }
      if(from === to){ toast('Не можна відправити самому собі', false); return; }
      if((users[from]?.balance ?? 0) < amount){ toast('Недостатньо коінів', false); return; }
      users[from].balance -= amount;
      users[to].balance += amount;
      setUsers(users);
      const txs = getTx();
      txs.push({ from, to, amount, ts: Date.now() });
      setTx(txs);
      $('sendAmount').value=''; $('sendTo').value='';
      renderBalance(); renderUsers(); renderTx();
      toast('Переказ виконано ✅');
    });

    // === Експорт / Імпорт у файл ===
    $('exportBtn').addEventListener('click', () => {
      const data = {
        users: getUsers(),
        transactions: getTx(),
        exportedAt: new Date().toISOString(),
        note: 'UA Coins backup file'
      };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'ua-coins-backup.json'; a.click();
      URL.revokeObjectURL(url);
    });

    $('importFile').addEventListener('change', async (e) => {
      const file = e.target.files?.[0]; if(!file) return;
      try {
        const text = await file.text();
        const data = JSON.parse(text);
        if(!data.users || !data.transactions) throw new Error('Некоректний файл');
        setUsers(data.users); setTx(data.transactions);
        toast('Імпортовано успішно');
        renderUsers(); renderTx(); renderBalance();
      } catch(err){ toast('Помилка імпорту: ' + err.message, false); }
      e.target.value = '';
    });

    // === Ініціалізація ===
    (function init(){
      const s = getSession();
      if(s && getUsers()[s.nick]){ showApp(true); renderBalance(); } else { showApp(false); }
      renderUsers(); renderTx();
    })();

    // === TODO: Підключення онлайн-бази (опційно) ===
    // Для спільного доступу друзів через інтернет можна додати Firebase Firestore.
    // 1) Створіть проект у Firebase Console, увімкніть Firestore та Authentication (Email/Password).
    // 2) Додайте <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app-compat.js"></script>
    //             <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore-compat.js"></script>
    //             <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-auth-compat.js"></script>
    // 3) Створіть конфігурацію firebaseConfig та перепишіть функції getUsers/setUsers/getTx/setTx на читання з Firestore.
    // 4) Аутентифікацію можна залишити нік+пароль (зберігаючи хеш у Firestore) або перейти на email+пароль.
  </script>
</body>
</html>
