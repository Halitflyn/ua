<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>UA –ø–µ—Ä–µ–∫–ª–∞–¥–∏ –¥–ª—è –º–æ–¥—ñ–≤</title>
  <style>
    :root {
      --bg: #f5f5f5;
      --card: #fff;
      --text: #111;
      --accent: #4CAF50;
    }
    body.dark {
      --bg: #181818;
      --card: #242424;
      --text: #eee;
      --accent: #6ddf8c;
    }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      transition: background 0.3s, color 0.3s;
    }
    header {
      padding: 15px;
      background: var(--card);
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    header h1 { margin: 0; font-size: 20px; }
    .filters {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin: 15px;
    }
    input, select {
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 6px;
      outline: none;
    }
    .mod-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 20px;
      padding: 20px;
    }
    .mod-card {
      background: var(--card);
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      transition: transform 0.2s, box-shadow 0.2s;
      opacity: 0;
      transform: translateY(20px);
      animation: fadeIn 0.5s forwards;
    }
    .mod-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.2);
    }
    .mod-card img {
      width: 100%;
      border-radius: 12px;
      margin-bottom: 10px;
    }
    .download-btn {
      display: inline-block;
      padding: 8px 12px;
      margin-top: 10px;
      background: var(--accent);
      color: white;
      border-radius: 6px;
      text-decoration: none;
      font-weight: bold;
      cursor: pointer;
      border: none;
    }
    .download-btn:hover { opacity: 0.9; }
    @keyframes fadeIn {
      to { opacity: 1; transform: translateY(0); }
    }
    footer {
      text-align: center;
      padding: 10px;
      font-size: 12px;
      opacity: 0.7;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>
  <header>
    <h1>üì¶ UA –ø–µ—Ä–µ–∫–ª–∞–¥–∏ –¥–ª—è –º–æ–¥—ñ–≤</h1>
    <button onclick="toggleTheme()">üåô</button>
  </header>

  <div class="filters">
    <input type="text" id="searchInput" placeholder="üîç –ü–æ—à—É–∫ –∑–∞ –Ω–∞–∑–≤–æ—é..." oninput="renderMods()">
    <select id="versionFilter" onchange="renderMods()">
      <option value="">–í—Å—ñ –≤–µ—Ä—Å—ñ—ó</option>
    </select>
    <select id="authorFilter" onchange="renderMods()">
      <option value="">–í—Å—ñ –∞–≤—Ç–æ—Ä–∏</option>
    </select>
    <button onclick="resetFilters()">–°–∫–∏–Ω—É—Ç–∏</button>
  </div>

  <div class="mod-list" id="modList"></div>

  <footer>
    —á–∞—Å –≤—ñ–¥ —á–∞—Å—É –∑‚Äô—è–≤–ª—è—î—Ç—å—Å—è –Ω–æ–≤–∏–π –ø–µ—Ä–µ–∫–ª–∞–¥, –∞–ª–µ —â–æ–± –≤—ñ–Ω —É –≤–∞—Å –∑‚Äô—è–≤–∏–≤—Å—è –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å <b>Ctrl+F5</b>
  </footer>

<script>
  let mods = [];  // –≤—Å—ñ –º–æ–¥–∏
  let versions = new Set();
  let authors = new Set();

async function loadMods() {
  const index = await fetch("mods/index.json").then(r => r.json());

  for (const modName of index.mods) {
    await loadMod(modName);
  }

  fillFilters();
  renderMods();
}

  async function loadMod(modName) {
    const [modTxt, modJson, image] = await Promise.all([
      fetch(`mods/${modName}/mod.txt`).then(r => r.text()),
      fetch(`mods/${modName}/mod.json`).then(r => r.json()),
      fetch(`mods/${modName}/image.jpeg`).then(r => r.blob())
    ]);

    const langs = ["Halitflyn.json","fehyki.json"]; // –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ auto index
    const [title, desc, link] = modTxt.split("\n");

    mods.push({
      name: title,
      desc, link,
      modName,
      image: URL.createObjectURL(image),
      versions: modJson,
      langs
    });

    modJson.forEach(v => {
      versions.add(v.version);
      authors.add(v.author);
    });
  }

  function fillFilters() {
    const versionSelect = document.getElementById("versionFilter");
    versions.forEach(v => {
      versionSelect.innerHTML += `<option value="${v}">${v}</option>`;
    });
    const authorSelect = document.getElementById("authorFilter");
    authors.forEach(a => {
      authorSelect.innerHTML += `<option value="${a}">${a}</option>`;
    });
  }

  function renderMods() {
    const search = document.getElementById("searchInput").value.toLowerCase();
    const version = document.getElementById("versionFilter").value;
    const author = document.getElementById("authorFilter").value;

    const list = document.getElementById("modList");
    list.innerHTML = "";

    mods
      .filter(m => m.name.toLowerCase().includes(search))
      .forEach(mod => {
        const filteredVersions = mod.versions.filter(v =>
          (!version || v.version === version) &&
          (!author || v.author === author)
        );
        if (!filteredVersions.length) return;

        const card = document.createElement("div");
        card.className = "mod-card";
        card.innerHTML = `
          <img src="${mod.image}">
          <h2>${mod.name}</h2>
          <p>${mod.desc}</p>
          <a href="${mod.link}" target="_blank">–°—Ç–æ—Ä—ñ–Ω–∫–∞ –Ω–∞ Modrinth</a><br><br>
          <label>–û–±–µ—Ä—ñ—Ç—å –≤–µ—Ä—Å—ñ—é:</label><br>
          <select id="ver-${mod.modName}">
            ${filteredVersions.map(v=>`<option value="${v.link}" data-name="${v.name}" data-author="${v.author}">${v.version} (${v.author})</option>`).join("")}
          </select><br>
          <button class="download-btn">‚¨áÔ∏è –°–∫–∞—á–∞—Ç–∏ –∑ –ø–µ—Ä–µ–∫–ª–∞–¥–æ–º</button>
        `;

        card.querySelector(".download-btn").onclick = async () => {
          const select = card.querySelector(`#ver-${mod.modName}`);
          const link = select.value;
          const author = select.selectedOptions[0].dataset.author;
          const name = select.selectedOptions[0].dataset.name;

          const [modFile, uaJson] = await Promise.all([
            fetch(link).then(r=>r.arrayBuffer()),
            fetch(`mods/${mod.modName}/Lang/${author}.json`).then(r=>r.text())
          ]);

          const zip = new JSZip();
          await zip.loadAsync(modFile);
          zip.file("assets/"+mod.modName+"/lang/uk_ua.json", uaJson);

          const newJar = await zip.generateAsync({type:"blob"});
          const a = document.createElement("a");
          a.href = URL.createObjectURL(newJar);
          a.download = `${name}.jar`;
          a.click();
        };

        list.appendChild(card);
      });
  }

  function resetFilters() {
    document.getElementById("searchInput").value="";
    document.getElementById("versionFilter").value="";
    document.getElementById("authorFilter").value="";
    renderMods();
  }

  function toggleTheme() {
    document.body.classList.toggle("dark");
  }

  loadMods();
</script>
</body>
</html>
