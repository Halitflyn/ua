<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–ú–æ–¥–∏ –∑ –ø–µ—Ä–µ–∫–ª–∞–¥–æ–º</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f5f5f5;
      color: #222;
    }

    header {
      padding: 1rem;
      text-align: center;
      background: #2c3e50;
      color: #fff;
    }

    #filters {
      display: flex;
      gap: 1rem;
      justify-content: center;
      padding: 1rem;
      flex-wrap: wrap;
      background: #ecf0f1;
    }

    #mods {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      padding: 20px;
    }

    .mod-card {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .mod-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.15);
    }

    .mod-card img {
      width: 100%;
      height: 150px;
      object-fit: cover;
    }

    .info {
      padding: 12px;
      flex-grow: 1;
    }

    .info h3 {
      margin: 0 0 8px;
      font-size: 1.1rem;
    }

    .buttons {
      display: flex;
      gap: 8px;
      padding: 12px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .buttons button {
      padding: 8px 12px;
      border: none;
      border-radius: 8px;
      background: #3498db;
      color: white;
      cursor: pointer;
      transition: background 0.2s;
    }

    .buttons button:hover {
      background: #2980b9;
    }
  </style>
</head>
<body>
  <header>
    <h1>üì¶ –ö–∞—Ç–∞–ª–æ–≥ –º–æ–¥—ñ–≤ –∑ –ø–µ—Ä–µ–∫–ª–∞–¥–∞–º–∏</h1>
  </header>

  <div id="filters">
    <input type="text" id="search" placeholder="üîç –ü–æ—à—É–∫ –ø–æ –Ω–∞–∑–≤—ñ...">
    <select id="versionFilter"><option value="">–í–µ—Ä—Å—ñ—è –≥—Ä–∏</option></select>
    <select id="authorFilter"><option value="">–ê–≤—Ç–æ—Ä –ø–µ—Ä–µ–∫–ª–∞–¥—É</option></select>
  </div>

  <div id="mods"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script>
    let allMods = [];

    async function loadMods() {
      const index = await fetch("mods/index.json").then(r => r.json());
      for (const modName of index.mods) {
        await loadMod(modName);
      }
      fillFilters();
      renderMods();
    }

    async function loadMod(name) {
      const [info, desc, img] = await Promise.all([
        fetch(`mods/${name}/mod.json`).then(r => r.json()),
        fetch(`mods/${name}/mod.txt`).then(r => r.text()),
        fetch(`mods/${name}/image.jpeg`).then(r => r.blob())
      ]);
      allMods.push({ name, info, desc, img: URL.createObjectURL(img) });
    }

    function fillFilters() {
      const versionSet = new Set(), authorSet = new Set();
      allMods.forEach(m => m.info.forEach(v => {
        versionSet.add(v.version);
        authorSet.add(v.author);
      }));
      const vf = document.getElementById("versionFilter");
      versionSet.forEach(v => vf.innerHTML += `<option value="${v}">${v}</option>`);
      const af = document.getElementById("authorFilter");
      authorSet.forEach(a => af.innerHTML += `<option value="${a}">${a}</option>`);
    }

    function renderMods() {
      const q = document.getElementById("search").value.toLowerCase();
      const v = document.getElementById("versionFilter").value;
      const a = document.getElementById("authorFilter").value;
      const container = document.getElementById("mods");
      container.innerHTML = "";

      allMods.forEach(mod => {
        let match = mod.name.toLowerCase().includes(q);
        if (v && !mod.info.some(i => i.version === v)) match = false;
        if (a && !mod.info.some(i => i.author === a)) match = false;
        if (!match) return;

        const card = document.createElement("div");
        card.className = "mod-card";
        card.innerHTML = `
          <img src="${mod.img}" alt="${mod.name}">
          <div class="info">
            <h3>${mod.name}</h3>
            <p>${mod.desc}</p>
          </div>
        `;

        const btns = document.createElement("div");
        btns.className = "buttons";
        const dl = document.createElement("button");
        dl.textContent = "‚¨áÔ∏è –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏";
        dl.onclick = () => downloadMod(mod);
        btns.appendChild(dl);
        card.appendChild(btns);

        container.appendChild(card);
      });
    }

    async function downloadMod(mod) {
      const ver = mod.info[0]; // –ø–æ–∫–∏ —â–æ –ø–µ—Ä—à–∞ –≤–µ—Ä—Å—ñ—è
      const [modFile, langFile] = await Promise.all([
        fetch(ver.link).then(r => r.blob()),
        fetch(`mods/${mod.name}/Lang/${ver.author}.json`).then(r => r.blob())
      ]);
      const zip = new JSZip();
      zip.file("mod.jar", modFile);
      zip.file("ua_uk.json", langFile);
      const blob = await zip.generateAsync({ type: "blob" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = `${ver.name}.zip`;
      a.click();
    }

    document.getElementById("search").oninput = renderMods;
    document.getElementById("versionFilter").onchange = renderMods;
    document.getElementById("authorFilter").onchange = renderMods;

    loadMods();
  </script>
</body>
</html>
