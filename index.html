<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–£–∫—Ä–∞—ó–Ω—Å—å–∫—ñ –ø–µ—Ä–µ–∫–ª–∞–¥–∏ –º–æ–¥—ñ–≤</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 20px; }
    h1 { text-align: center; }
    .mod-list { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; }
    .mod-card { background: #fff; padding: 15px; border-radius: 12px; width: 260px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); position: relative; }
    .mod-card img { width: 80%; display: block; margin: 0 auto 10px; border-radius: 8px; }
    button { background: #4CAF50; border: none; color: white; padding: 8px 12px; border-radius: 6px; cursor: pointer; }
    button:hover { background: #3c9642; }
    .popup { display: none; position: absolute; top: 10px; left: 10px; right: 10px; background: #fff; border: 1px solid #ccc; border-radius: 10px; padding: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.3); }
    .popup select { width: 100%; margin-bottom: 10px; padding: 5px; }
    .popup button { width: 100%; }
  </style>
</head>
<body>
  <h1>üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫—ñ –ø–µ—Ä–µ–∫–ª–∞–¥–∏ –º–æ–¥—ñ–≤</h1>
  <div class="mod-list" id="mod-list"></div>

  <script>
    const repoOwner = "halitflyn";
    const repoName = "ua";
    const basePath = "mods";
    const rawBaseUrl = `https://raw.githubusercontent.com/${repoOwner}/${repoName}/main`;

    async function fetchRepoContents(path) {
      const url = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${path}`;
      const res = await fetch(url);
      if (!res.ok) return null;
      return await res.json();
    }

    async function loadMods() {
      const mods = await fetchRepoContents(basePath);
      if (!mods) return;
      const modList = document.getElementById("mod-list");

      for (const mod of mods) {
        if (mod.type !== "dir") continue;
        const modPath = `${basePath}/${mod.name}`;
        const contents = await fetchRepoContents(modPath);
        if (!contents) continue;

        let modJson=null, modTxt=null, imageUrl=null, langFiles=[];
        for (const file of contents) {
          if (file.name === "mod.json") {
            const res = await fetch(`${rawBaseUrl}/${modPath}/mod.json`);
            modJson = res.ok ? await res.json() : null;
          } else if (file.name === "mod.txt") {
            const res = await fetch(`${rawBaseUrl}/${modPath}/mod.txt`);
            modTxt = res.ok ? await res.text() : null;
          } else if (file.name === "image.jpeg") {
            imageUrl = `${rawBaseUrl}/${modPath}/image.jpeg`;
          } else if (file.name === "lang") {
            const langs = await fetchRepoContents(`${modPath}/lang`);
            if (langs) {
              langFiles = langs.map(l => ({
                author: l.name.replace(".json",""),
                url: `${rawBaseUrl}/${modPath}/lang/${l.name}`
              }));
            }
          }
        }
        if (!modJson || !modTxt) continue;
        const [name, description] = modTxt.trim().split("\n");

        const card = document.createElement("div");
        card.className = "mod-card";

        card.innerHTML = `
          <img src="${imageUrl}" alt="${name}">
          <h2>${name}</h2>
          <p>${description}</p>
          <button onclick="togglePopup('${mod.name}')">–í–∏–±—Ä–∞—Ç–∏ –ø–µ—Ä–µ–∫–ª–∞–¥</button>
          <div class="popup" id="popup-${mod.name}">
            <select id="ver-${mod.name}">
              ${modJson.map(v=>`<option value="${v.link}">${v.version} (${v.loader})</option>`).join("")}
            </select>
            <select id="lang-${mod.name}">
              ${langFiles.map(l=>`<option value="${l.url}">${l.author}</option>`).join("")}
            </select>
            <button onclick="downloadBoth('${mod.name}')">‚¨áÔ∏è –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</button>
          </div>
        `;
        modList.appendChild(card);
      }
    }

    function togglePopup(modName) {
      const popup = document.getElementById(`popup-${modName}`);
      popup.style.display = popup.style.display === "block" ? "none" : "block";
    }

    async function downloadFile(url, filename) {
      const res = await fetch(url);
      const blob = await res.blob();
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      a.click();
    }

    function downloadBoth(modName) {
      const verSelect = document.getElementById(`ver-${modName}`);
      const langSelect = document.getElementById(`lang-${modName}`);
      const jarUrl = verSelect.value;
      const jsonUrl = langSelect.value;

      // –∫–∞—á–∞—î–º–æ jar
      const jarName = jarUrl.split("/").pop();
      downloadFile(jarUrl, jarName);

      // –∫–∞—á–∞—î–º–æ json —è–∫ uk_ua.json
      downloadFile(jsonUrl, "uk_ua.json");

      togglePopup(modName);
    }

    loadMods();
  </script>
</body>
</html>
