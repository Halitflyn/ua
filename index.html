<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>UA переклади для модів</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f8f8f8; padding: 20px; }
    .mod-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
    .mod-card { background: #fff; border-radius: 12px; padding: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .mod-card img { width: 100%; border-radius: 12px; margin-bottom: 10px; }
    .mod-card h2 { margin: 5px 0; }
    .download-btn { display: inline-block; padding: 10px 15px; background: #4CAF50; color: white; border-radius: 8px; text-decoration: none; font-weight: bold; cursor: pointer; }
    .download-btn:hover { background: #45a049; }
    select { margin: 10px 0; padding: 5px; }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>
  <h1>Переклади українською для модів</h1>
  <div class="mod-list" id="modList"></div>

  <script>
    async function loadMod(modName) {
      // читаємо файли
      const [modTxt, modJson, image] = await Promise.all([
        fetch(`mods/${modName}/mod.txt`).then(r => r.text()),
        fetch(`mods/${modName}/mod.json`).then(r => r.json()),
        fetch(`mods/${modName}/image.jpeg`).then(r => r.blob())
      ]);

      const langs = ["Halitflyn.json", "fehyki.json"]; // можна генерувати з index.json

      const [title, desc, link] = modTxt.split("\n");
      const latest = modJson[modJson.length - 1]; // остання версія

      // створюємо картку
      const card = document.createElement("div");
      card.className = "mod-card";
      card.innerHTML = `
        <img src="${URL.createObjectURL(image)}" alt="${title}">
        <h2>${title}</h2>
        <p>${desc}</p>
        <a href="${link}" target="_blank">Сторінка на Modrinth</a><br><br>
        <label>Оберіть переклад:</label><br>
        <select id="langSelect-${modName}">
          ${langs.map(l => `<option value="${l}">${l.replace(".json","")}</option>`).join("")}
        </select><br>
        <button class="download-btn">Скачати з перекладом</button>
      `;

      card.querySelector(".download-btn").onclick = async () => {
        const langFile = document.getElementById(`langSelect-${modName}`).value;
        const [modFile, uaJson] = await Promise.all([
          fetch(latest.link).then(r => r.arrayBuffer()),
          fetch(`mods/${modName}/Lang/${langFile}`).then(r => r.text())
        ]);

        const zip = new JSZip();
        await zip.loadAsync(modFile);

        // ⚡ Шлях усередині мода — треба налаштувати для кожного
        zip.file("assets/tensura/lang/uk_ua.json", uaJson);

        const newJar = await zip.generateAsync({ type: "blob" });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(newJar);
        a.download = `${latest.name}.jar`;
        a.click();
      };

      document.getElementById("modList").appendChild(card);
    }

    // поки вручну, але можна зробити index.json
    loadMod("tensura");
  </script>
</body>
</html>
