<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–∫—Ä–∞—ó–Ω—Å—å–∫—ñ –ø–µ—Ä–µ–∫–ª–∞–¥–∏ –º–æ–¥—ñ–≤</title>
    <link rel="icon" href="data:,">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        h1 {
            text-align: center;
        }
        #search-container {
            text-align: center;
            margin-bottom: 20px;
        }
        #search-input, select {
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 0 5px 10px 0;
        }
        #search-input {
            width: 300px;
        }
        .mod-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        .mod-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin: 10px;
            padding: 15px;
            width: 220px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .mod-card img {
            width: 66.67%;
            height: auto;
            border-radius: 4px;
            display: block;
            margin: 0 auto;
        }
        .mod-card h2 {
            margin: 10px 0;
        }
        .mod-card p {
            margin: 5px 0;
        }
        .version-list {
            margin-top: 10px;
        }
        .version-item {
            margin-bottom: 10px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 4px;
            margin-top: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        #combine-open {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
        }
        
        .help-button {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 1000;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #007bff;
            color: white;
            border: none;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .help-button:hover {
            background-color: #0056b3;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            padding-top: 20px;
        }
        
        /* –°–ø–µ—Ü—ñ–∞–ª—å–Ω–µ –ø–æ–∑–∏—Ü—ñ–æ–Ω—É–≤–∞–Ω–Ω—è –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –¥–æ–ø–æ–º–æ–≥–∏ */
        #help-modal {
            padding-top: 10px;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 2% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 8px;
        }
        
        /* –°–ø–µ—Ü—ñ–∞–ª—å–Ω–µ –ø–æ–∑–∏—Ü—ñ–æ–Ω—É–≤–∞–Ω–Ω—è –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –¥–æ–ø–æ–º–æ–≥–∏ */
        #help-modal .modal-content {
            margin: 1% auto;
            max-height: 95vh;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        #select-list div {
            margin-bottom: 15px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }
        .hidden {
            display: none;
        }
        
        /* –°—Ç–∏–ª—ñ –¥–ª—è —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó */
        .help-content {
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .step {
            margin-bottom: 25px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        
        .step h3 {
            margin-top: 0;
            color: #333;
        }
        
        .help-image {
            max-width: 100%;
            height: auto;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin: 10px 0;
        }
        
        .file-examples {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .file-examples .help-image {
            max-width: 45%;
        }
        
        /* –¢–µ–º–Ω–∞ —Ç–µ–º–∞ */
        body.dark-theme {
            background-color: #1a1a1a;
            color: #e0e0e0;
        }
        
        body.dark-theme .mod-card {
            background-color: #2d2d2d;
            border-color: #444;
            color: #e0e0e0;
        }
        
        body.dark-theme .modal-content {
            background-color: #2d2d2d;
            color: #e0e0e0;
            border-color: #444;
        }
        
        body.dark-theme .step {
            background-color: #3d3d3d;
            border-color: #555;
        }
        
        body.dark-theme .step h3 {
            color: #e0e0e0;
        }
        
        body.dark-theme .close:hover,
        body.dark-theme .close:focus {
            color: #e0e0e0;
        }
        
        body.dark-theme #search-input,
        body.dark-theme select {
            background-color: #3d3d3d;
            color: #e0e0e0;
            border-color: #555;
        }
        
        body.dark-theme button {
            background-color: #007bff;
        }
        
        body.dark-theme button:hover {
            background-color: #0056b3;
        }
        
        /* –ü–µ—Ä–µ–º–∏–∫–∞—á —Ç–µ–º–∏ */
        .theme-toggle {
            position: fixed;
            top: 10px;
            left: 60px;
            z-index: 1000;
            padding: 8px 12px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .theme-toggle:hover {
            background-color: #5a6268;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>
<h1>–£–∫—Ä–∞—ó–Ω—Å—å–∫—ñ –ø–µ—Ä–µ–∫–ª–∞–¥–∏ –º–æ–¥—ñ–≤ (—è–∫ Modrinth)</h1>
<div id="search-container">
    <input type="text" id="search-input" placeholder="–ü–æ—à—É–∫ –ø–æ –Ω–∞–∑–≤—ñ –º–æ–¥–∞..."><br>
    <select id="filter-version">
        <option value="">–í—Å—ñ –≤–µ—Ä—Å—ñ—ó</option>
    </select>
    <select id="filter-core">
        <option value="">–í—Å—ñ —è–¥—Ä–∞</option>
    </select>
    <select id="filter-author">
        <option value="">–í—Å—ñ –∞–≤—Ç–æ—Ä–∏</option>
    </select>
</div>
    <button id="help-open" class="help-button">?</button>
    <button id="theme-toggle" class="theme-toggle">üåô</button>
<button id="combine-open">–û–±'—î–¥–Ω–∞—Ç–∏ –º–æ–¥</button>
<div id="mod-list" class="mod-list"></div>

    <div id="help-modal" class="modal">
        <div class="modal-content">
            <span class="close help-close">&times;</span>
            <h2>–Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –∑—ñ —Å–∫–∞—á—É–≤–∞–Ω–Ω—è —Ç–∞ –æ–±'—î–¥–Ω–∞–Ω–Ω—è –º–æ–¥–∞ –∑ –ø–µ—Ä–µ–∫–ª–∞–¥–æ–º</h2>
            <div class="help-content">
                <div class="step">
                    <h3>1. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É ¬´–í–∏–±—Ä–∞—Ç–∏ –ø–µ—Ä–µ–∫–ª–∞–¥¬ª</h3>
                    <img src="image/inf1.jpeg" alt="–ö—Ä–æ–∫ 1" class="help-image">
                </div>
                
                <div class="step">
                    <h3>2. –í–∏–±–µ—Ä—ñ—Ç—å –ø–æ—Ç—Ä—ñ–±–Ω–∏–π –ø–µ—Ä–µ–∫–ª–∞–¥ —ñ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É ¬´–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏¬ª</h3>
                    <img src="image/inf2.jpeg" alt="–ö—Ä–æ–∫ 2" class="help-image">
                </div>
                
                <div class="step">
                    <h3>3. –í–∫–∞–∂—ñ—Ç—å –º—ñ—Å—Ü–µ –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ç–∏–º—á–∞—Å–æ–≤–æ–≥–æ —Ñ–∞–π–ª—É –º–æ–¥–∞ —Ç–∞ —Ç–∏–º—á–∞—Å–æ–≤–æ–≥–æ —Ñ–∞–π–ª—É –∑ –ø–µ—Ä–µ–∫–ª–∞–¥–æ–º</h3>
                    <div class="file-examples">
                        <img src="image/inf3.jpeg" alt="JAR —Ñ–∞–π–ª" class="help-image">
                        <img src="image/inf4.jpeg" alt="JSON —Ñ–∞–π–ª" class="help-image">
                    </div>
                </div>
                
                <div class="step">
                    <h3>4. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É ¬´–û–±'—î–¥–Ω–∞—Ç–∏ –º–æ–¥¬ª</h3>
                    <img src="image/inf5.jpeg" alt="–ö—Ä–æ–∫ 4" class="help-image">
                </div>
                
                <div class="step">
                    <h3>5. –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –º–æ–¥ (****.jar) —ñ –ø–µ—Ä–µ–∫–ª–∞–¥ (uk_ua.json) ‚Äî —Å–∞–π—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±'—î–¥–Ω–∞—î —ó—Ö –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –Ω–∞ –∫–Ω–æ–ø–∫—É</h3>
                    <img src="image/inf6.jpeg" alt="–ö—Ä–æ–∫ 5" class="help-image">
                </div>
                
                <div class="step">
                    <h3>6. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É ¬´–û–±'—î–¥–Ω–∞—Ç–∏ —Ç–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏¬ª —Ç–∞ –≤–∏–±–µ—Ä—ñ—Ç—å, –∫—É–¥–∏ –∑–±–µ—Ä–µ–≥—Ç–∏ –≥–æ—Ç–æ–≤–∏–π –º–æ–¥</h3>
                    <img src="image/inf7.jpeg" alt="–ö—Ä–æ–∫ 6" class="help-image">
                </div>
                
                <div class="step">
                    <h3>–ù–∞—Å–æ–ª–æ–¥–∂—É–π—Ç–µ—Å—è –≥—Ä–æ—é —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é! üéâ</h3>
                </div>
            </div>
        </div>
    </div>
    
    <div id="combine-modal" class="modal">
        <div class="modal-content">
            <span class="close combine-close">&times;</span>
            <h2>–û–±'—î–¥–Ω–∞—Ç–∏ –º–æ–¥ —ñ –ø–µ—Ä–µ–∫–ª–∞–¥</h2>
            <p>–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –º–æ–¥ (.jar) —ñ –ø–µ—Ä–µ–∫–ª–∞–¥ (uk_ua.json), —Å–∞–π—Ç –æ–±'—î–¥–Ω–∞—î —ó—Ö —ñ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç—å –æ–Ω–æ–≤–ª–µ–Ω–∏–π –º–æ–¥.</p>
            <input type="file" id="mod-file" accept=".jar">
            <input type="file" id="json-file" accept=".json">
            <button onclick="combineFiles()">–û–±'—î–¥–Ω–∞—Ç–∏ —Ç–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</button>
        </div>
    </div>

    <div id="select-modal" class="modal">
        <div class="modal-content">
            <span class="close select-close">&times;</span>
            <h2>–í–∏–±—Ä–∞—Ç–∏ –ø–µ—Ä–µ–∫–ª–∞–¥</h2>
            <div id="select-list"></div>
        </div>
    </div>

<script>
const repoOwner = 'halitflyn';
const repoName = 'ua';
const basePath = 'mods';
const rawBaseUrl = `https://raw.githubusercontent.com/${repoOwner}/${repoName}/main`;

// –ú–∞—Å–∏–≤–∏ –¥–ª—è —Ñ—ñ–ª—å—Ç—Ä—ñ–≤
let allVersions = new Set();
let allCores = new Set();
let allAuthors = new Set();
        
        // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–∞–Ω—ñ –ø—Ä–æ –º–æ–¥–∏ –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
        let modsData = [];

async function fetchRepoContents(path) {
    const url = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${path}`;
    try {
        const response = await fetch(url);
                if (!response.ok) {
                    return null;
                }
        return await response.json();
            } catch (e) {
                console.error(`Error fetching contents for ${path}:`, e);
                return null;
            }
}

async function loadMods() {
    const mods = await fetchRepoContents(basePath);
    if (!mods || !Array.isArray(mods)) return;

    const modListDiv = document.getElementById('mod-list');

    for (const mod of mods) {
        if (mod.type !== 'dir') continue;

        const modPath = `${basePath}/${mod.name}`;
        const modContents = await fetchRepoContents(modPath);
        if (!modContents || !Array.isArray(modContents)) continue;

                let modJson = null;
                let modTxt = null;
                let imageUrl = null;
                let langFiles = [];

        for (const file of modContents) {
            if (file.name === 'mod.json') {
                try { 
                    const jsonResponse = await fetch(`${rawBaseUrl}/${modPath}/mod.json`);
                            if (jsonResponse.ok) {
                                modJson = await jsonResponse.json();
                                if (!Array.isArray(modJson)) modJson = null;
                            }
                        } catch (e) {
                            console.error(`Error fetching mod.json for ${mod.name}:`, e);
                        }
            } else if (file.name === 'mod.txt') {
                        try {
                            const txtResponse = await fetch(`${rawBaseUrl}/${modPath}/mod.txt`);
                            if (txtResponse.ok) {
                                modTxt = await txtResponse.text();
                            }
                        } catch (e) {
                            console.error(`Error fetching mod.txt for ${mod.name}:`, e);
                        }
                    } else if (file.name === 'image.jpeg') {
                        imageUrl = `${rawBaseUrl}/${modPath}/image.jpeg`;
                    } else if (file.name === 'lang' && file.type === 'dir') {
                const langPath = `${modPath}/lang`;
                const langContents = await fetchRepoContents(langPath);
                        if (langContents && Array.isArray(langContents)) {
                            langFiles = langContents.map(f => ({
                                author: f.name.replace('.json', ''),
                                url: `${rawBaseUrl}/${langPath}/${f.name}`
                            }));
                        }
            }
        }

        if (modJson && modTxt && imageUrl) {
            const [name, description, modrinthLink] = modTxt.trim().split('\n');

                    // Aggregate versions and loaders
                    const allVersionsArr = modJson.map(v => v.version).sort((a, b) => {
                        const aParts = a.split('.').map(Number);
                        const bParts = b.split('.').map(Number);
                        for (let i = 0; i < Math.max(aParts.length, bParts.length); i++) {
                            if ((aParts[i] || 0) !== (bParts[i] || 0)) {
                                return (aParts[i] || 0) - (bParts[i] || 0);
                            }
                        }
                        return 0;
                    });
                    const uniqueVersions = [...new Set(allVersionsArr)];
                    const minVersion = uniqueVersions[0];
                    const maxVersion = uniqueVersions[uniqueVersions.length - 1];
                    const versionText = minVersion === maxVersion ? minVersion : `${minVersion}-${maxVersion}`;

                    const allLoadersArr = modJson.map(v => v.loader);
                    const uniqueLoaders = [...new Set(allLoadersArr)];
                    const loadersDisplay = uniqueLoaders.join(' - ');

                    const allAuthorsArr = modJson.map(v => v.author);

            // –î–æ–¥–∞—Ç–∏ —É –º–Ω–æ–∂–∏–Ω–∏ –¥–ª—è —Ñ—ñ–ª—å—Ç—Ä—ñ–≤
                    allVersionsArr.forEach(v => allVersions.add(v));
                    allLoadersArr.forEach(l => allCores.add(l));
                    allAuthorsArr.forEach(a => allAuthors.add(a));

                    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–∞–Ω—ñ –ø—Ä–æ –º–æ–¥
                    const modData = {
                        name,
                        description,
                        modrinthLink,
                        modJson,
                        langFiles,
                        imageUrl
                    };
                    modsData.push(modData);

            const card = document.createElement('div');
            card.className = 'mod-card';
            card.dataset.name = name.toLowerCase();
                    card.dataset.versions = allVersionsArr.join(' ').toLowerCase();
                    card.dataset.loaders = uniqueLoaders.join(' ').toLowerCase();
                    card.dataset.authors = allAuthorsArr.join(' ').toLowerCase();
                    card.dataset.modIndex = modsData.length - 1;
            card.innerHTML = `
                <img src="${imageUrl}" alt="${name}">
                <h2>${name}</h2>
                <p>${description}</p>
                <p><a href="${modrinthLink}" target="_blank">Modrinth —Å—Ç–æ—Ä—ñ–Ω–∫–∞</a></p>
                        <p>–í–µ—Ä—Å—ñ—è: ${versionText}</p>
                        <p>(${loadersDisplay})</p>
            `;
            const selectButton = document.createElement('button');
            selectButton.textContent = '–í–∏–±—Ä–∞—Ç–∏ –ø–µ—Ä–µ–∫–ª–∞–¥';
            selectButton.addEventListener('click', () => showSelectModal(modJson, langFiles, name));
            card.appendChild(selectButton);

            modListDiv.appendChild(card);
        }
    }

            // –ó–∞–ø–æ–≤–Ω–∏—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏
    populateFilterOptions();
}

// –ó–∞–ø–æ–≤–Ω–∏—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏
function populateFilterOptions() {
    const vSelect = document.getElementById('filter-version');
    const cSelect = document.getElementById('filter-core');
    const aSelect = document.getElementById('filter-author');

            [...allVersions].sort().forEach(v => {
                const opt = document.createElement('option');
                opt.value = v;
                opt.textContent = v;
                vSelect.appendChild(opt);
            });
            [...allCores].sort().forEach(c => {
                const opt = document.createElement('option');
                opt.value = c;
                opt.textContent = c;
                cSelect.appendChild(opt);
            });
            [...allAuthors].sort().forEach(a => {
                const opt = document.createElement('option');
                opt.value = a;
                opt.textContent = a;
                aSelect.appendChild(opt);
            });
        }

        function showSelectModal(modJson, langFiles, modName) {
            const modal = document.getElementById('select-modal');
            const list = document.getElementById('select-list');
            list.innerHTML = '';
            
            // –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ—Ç–æ—á–Ω—ñ —Ñ—ñ–ª—å—Ç—Ä–∏
            const versionFilter = document.getElementById('filter-version').value.toLowerCase();
            const coreFilter = document.getElementById('filter-core').value.toLowerCase();
            const authorFilter = document.getElementById('filter-author').value.toLowerCase();
            
            // –§—ñ–ª—å—Ç—Ä—É—î–º–æ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –≤–∏–±—Ä–∞–Ω–∏—Ö —Ñ—ñ–ª—å—Ç—Ä—ñ–≤
            let filteredVersions = modJson;
            
            if (versionFilter) {
                filteredVersions = filteredVersions.filter(version => 
                    version.version.toLowerCase() === versionFilter
                );
            }
            
            if (coreFilter) {
                filteredVersions = filteredVersions.filter(version => 
                    version.loader.toLowerCase() === coreFilter
                );
            }
            
            if (authorFilter) {
                filteredVersions = filteredVersions.filter(version => 
                    version.author.toLowerCase() === authorFilter
                );
            }
            
            let hasItems = false;
            filteredVersions.forEach(version => {
                const langFile = langFiles.find(l => l.author.toLowerCase() === version.author.toLowerCase());
                if (langFile) {
                    hasItems = true;
                    const item = document.createElement('div');
                    item.innerHTML = `
                        <p>–í–µ—Ä—Å—ñ—è: ${version.version} (${version.loader})</p>
                        <p>–ê–≤—Ç–æ—Ä: ${version.author}</p>
                    `;
                    const downloadButton = document.createElement('button');
                    downloadButton.textContent = '–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏';
                    downloadButton.addEventListener('click', () => downloadBoth(version.link, langFile.url, modName));
                    item.appendChild(downloadButton);
                    list.appendChild(item);
                }
            });
            
            if (!hasItems) {
                let message = '–ù–µ–º–∞—î –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –ø–µ—Ä–µ–∫–ª–∞–¥—ñ–≤';
                if (versionFilter || coreFilter || authorFilter) {
                    message += ' –¥–ª—è –≤–∏–±—Ä–∞–Ω–∏—Ö —Ñ—ñ–ª—å—Ç—Ä—ñ–≤';
                }
                message += '.';
                list.innerHTML = `<p>${message}</p>`;
            }
            
            modal.style.display = 'block';
        }

        async function downloadBoth(jarUrl, jsonUrl, modName) {
            // Download JAR
            const jarFilename = jarUrl.split('/').pop();
            const jarLink = document.createElement('a');
            jarLink.href = jarUrl;
            jarLink.download = jarFilename;
            document.body.appendChild(jarLink);
            jarLink.click();
            document.body.removeChild(jarLink);

            // Download JSON
            try {
                const response = await fetch(jsonUrl);
                if (!response.ok) {
                    throw new Error('–ü–µ—Ä–µ–∫–ª–∞–¥ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
                }
                const blob = await response.blob();
                const jsonLink = document.createElement('a');
                jsonLink.href = URL.createObjectURL(blob);
                jsonLink.download = 'uk_ua.json';
                document.body.appendChild(jsonLink);
                jsonLink.click();
                document.body.removeChild(jsonLink);
                URL.revokeObjectURL(jsonLink.href);
            } catch (e) {
                alert('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–µ—Ä–µ–∫–ª–∞–¥—É: ' + e.message);
            }
        }

        async function combineFiles() {
            const modFile = document.getElementById('mod-file').files[0];
            const jsonFile = document.getElementById('json-file').files[0];

            if (!modFile || !jsonFile) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –æ–±–∏–¥–≤–∞ —Ñ–∞–π–ª–∏.');
                return;
            }

            const zip = new JSZip();
            const modArrayBuffer = await modFile.arrayBuffer();
            await zip.loadAsync(modArrayBuffer);

            const jsonContent = await jsonFile.text();

            let modid = 'unknown';
            const modFiles = Object.keys(zip.files);

            // Check for Forge mods.toml
            if (zip.file('META-INF/mods.toml')) {
                const tomlContent = await zip.file('META-INF/mods.toml').async('string');
                const modidMatch = tomlContent.match(/modId\s*=\s*"([^"]+)"/);
                if (modidMatch) modid = modidMatch[1];
            } else if (zip.file('fabric.mod.json')) {
                // Fabric/Quilt
                const jsonContent = await zip.file('fabric.mod.json').async('string');
                const modMeta = JSON.parse(jsonContent);
                modid = modMeta.id;
            }

            if (modid !== 'unknown') {
                const langPath = `assets/${modid}/lang/uk_ua.json`;
                zip.file(langPath, jsonContent);
            } else {
                alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –≤–∏–∑–Ω–∞—á–∏—Ç–∏ modid. –î–æ–¥–∞–π—Ç–µ –≤—Ä—É—á–Ω—É.');
                return;
            }

            const newZipBlob = await zip.generateAsync({type: 'blob'});
            const url = URL.createObjectURL(newZipBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = modFile.name.replace('.jar', '_translated.jar');
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        // Modal controls
        const helpModal = document.getElementById('help-modal');
        const combineModal = document.getElementById('combine-modal');
        const selectModal = document.getElementById('select-modal');
        const helpOpen = document.getElementById('help-open');
        const combineOpen = document.getElementById('combine-open');
        const helpClose = document.querySelector('.help-close');
        const combineClose = document.querySelector('.combine-close');
        const selectClose = document.querySelector('.select-close');

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–∫—Ä–∏—Ç—Ç—è –≤—Å—ñ—Ö –º–æ–¥–∞–ª—å–Ω–∏—Ö –≤—ñ–∫–æ–Ω
        function closeAllModals() {
            helpModal.style.display = 'none';
            combineModal.style.display = 'none';
            selectModal.style.display = 'none';
        }
        
        helpOpen.onclick = () => { 
            closeAllModals();
            helpModal.style.display = 'block'; 
        };
        combineOpen.onclick = () => { 
            closeAllModals();
            combineModal.style.display = 'block'; 
        };
        helpClose.onclick = () => { helpModal.style.display = 'none'; };
        combineClose.onclick = () => { combineModal.style.display = 'none'; };
        selectClose.onclick = () => { selectModal.style.display = 'none'; };

        window.onclick = (event) => {
            if (event.target === helpModal || event.target === combineModal || event.target === selectModal) {
                closeAllModals();
            }
        };
        
        // –ü–µ—Ä–µ–º–∏–∫–∞—á —Ç–µ–º–∏
        const themeToggle = document.getElementById('theme-toggle');
        const body = document.body;
        
        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω—É —Ç–µ–º—É
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            body.classList.add('dark-theme');
            themeToggle.textContent = '‚òÄÔ∏è';
        }
        
        themeToggle.onclick = () => {
            body.classList.toggle('dark-theme');
            if (body.classList.contains('dark-theme')) {
                localStorage.setItem('theme', 'dark');
                themeToggle.textContent = '‚òÄÔ∏è';
            } else {
                localStorage.setItem('theme', 'light');
                themeToggle.textContent = 'üåô';
            }
        };

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤ –ø–µ—Ä–µ–∫–ª–∞–¥—É
        function getAvailableTranslations(modJson, langFiles, versionFilter, coreFilter, authorFilter) {
            let filteredVersions = modJson;
            
            if (versionFilter) {
                filteredVersions = filteredVersions.filter(version => 
                    version.version.toLowerCase() === versionFilter
                );
            }
            
            if (coreFilter) {
                filteredVersions = filteredVersions.filter(version => 
                    version.loader.toLowerCase() === coreFilter
                );
            }
            
            if (authorFilter) {
                filteredVersions = filteredVersions.filter(version => 
                    version.author.toLowerCase() === authorFilter
                );
            }
            
            const translations = [];
            filteredVersions.forEach(version => {
                const langFile = langFiles.find(l => l.author.toLowerCase() === version.author.toLowerCase());
                if (langFile) {
                    translations.push({
                        version: version,
                        langFile: langFile
                    });
                }
            });
            
            return translations;
}

// –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è + –ø–æ—à—É–∫ –ø–æ –Ω–∞–∑–≤—ñ
function filterMods() {
    const search = document.getElementById('search-input').value.toLowerCase();
    const versionFilter = document.getElementById('filter-version').value.toLowerCase();
    const coreFilter = document.getElementById('filter-core').value.toLowerCase();
    const authorFilter = document.getElementById('filter-author').value.toLowerCase();

    document.querySelectorAll('.mod-card').forEach(card => {
        const name = card.dataset.name;
        const versions = card.dataset.versions;
        const loaders = card.dataset.loaders;
        const authors = card.dataset.authors;
                const modIndex = parseInt(card.dataset.modIndex);

                const hasName = name.includes(search);
                const hasVersion = versionFilter === '' || versions.includes(versionFilter);
                const hasLoader = coreFilter === '' || loaders.includes(coreFilter);
                const hasAuthor = authorFilter === '' || authors.includes(authorFilter);

                if (hasName && hasVersion && hasLoader && hasAuthor) {
                    card.classList.remove('hidden');
                    
                    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤ –ø–µ—Ä–µ–∫–ª–∞–¥—É –¥–ª—è —Ü—å–æ–≥–æ –º–æ–¥–∞
                    const button = card.querySelector('button');
                    if (button) {
                        const modData = modsData[modIndex];
                        if (modData) {
                            const availableTranslations = getAvailableTranslations(
                                modData.modJson, 
                                modData.langFiles, 
                                versionFilter, 
                                coreFilter, 
                                authorFilter
                            );
                            
                            if (availableTranslations.length === 1) {
                                // –¢—ñ–ª—å–∫–∏ –æ–¥–∏–Ω –≤–∞—Ä—ñ–∞–Ω—Ç - –∑–º—ñ–Ω—é—î–º–æ –∫–Ω–æ–ø–∫—É –Ω–∞ "–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏"
                                button.textContent = '–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏';
                                // –í–∏–¥–∞–ª—è—î–º–æ –≤—Å—ñ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –æ–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π
                                button.replaceWith(button.cloneNode(true));
                                const newButton = card.querySelector('button');
                                newButton.onclick = () => {
                                    const translation = availableTranslations[0];
                                    downloadBoth(translation.version.link, translation.langFile.url, modData.name);
                                };
                            } else {
                                // –ö—ñ–ª—å–∫–∞ –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤ - –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—É –∫–Ω–æ–ø–∫—É
                                button.textContent = '–í–∏–±—Ä–∞—Ç–∏ –ø–µ—Ä–µ–∫–ª–∞–¥';
                                // –í–∏–¥–∞–ª—è—î–º–æ –≤—Å—ñ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –æ–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π
                                button.replaceWith(button.cloneNode(true));
                                const newButton = card.querySelector('button');
                                newButton.onclick = () => showSelectModal(modData.modJson, modData.langFiles, modData.name);
                            }
                        }
                    }
                } else {
                    card.classList.add('hidden');
                }
    });
}

loadMods().then(() => {
    document.getElementById('search-input').addEventListener('input', filterMods);
    document.getElementById('filter-version').addEventListener('change', filterMods);
    document.getElementById('filter-core').addEventListener('change', filterMods);
    document.getElementById('filter-author').addEventListener('change', filterMods);
});
</script>
</body>
</html>
