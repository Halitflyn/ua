<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–ú–æ–¥–∏ –∑ –ø–µ—Ä–µ–∫–ª–∞–¥–æ–º</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: var(--bg, #f5f5f5);
      color: var(--text, #222);
      transition: background 0.3s, color 0.3s;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background: var(--header-bg, #4CAF50);
      color: #fff;
    }
    header h1 {
      margin: 0;
      font-size: 22px;
    }
    .filters {
      display: flex;
      gap: 10px;
      padding: 10px 20px;
    }
    .filters select, .filters input {
      padding: 5px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    #mods {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      padding: 20px;
    }
    .mod-card {
      background: var(--card-bg, #fff);
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .mod-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.15);
    }
    .mod-card img {
      width: 100%;
      height: 150px;
      object-fit: cover;
    }
    .info {
      padding: 12px;
      flex-grow: 1;
    }
    .buttons {
      display: flex;
      gap: 8px;
      padding: 12px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .buttons button {
      padding: 6px 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background: #4CAF50;
      color: #fff;
      transition: background 0.2s;
    }
    .buttons button:hover {
      background: #45a049;
    }
    .dark {
      --bg: #1e1e1e;
      --text: #f0f0f0;
      --card-bg: #2a2a2a;
      --header-bg: #333;
    }
    footer {
      text-align: center;
      padding: 20px;
      font-size: 12px;
      opacity: 0.7;
    }
  </style>
</head>
<body>
  <header>
    <h1>üì¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫—ñ –ø–µ—Ä–µ–∫–ª–∞–¥–∏ –º–æ–¥—ñ–≤</h1>
    <button onclick="toggleTheme()">üåô</button>
  </header>

  <div class="filters">
    <input type="text" id="search" placeholder="–ü–æ—à—É–∫ –º–æ–¥—É..." oninput="renderMods()">
    <select id="versionFilter" onchange="renderMods()">
      <option value="">–í—Å—ñ –≤–µ—Ä—Å—ñ—ó</option>
    </select>
    <select id="authorFilter" onchange="renderMods()">
      <option value="">–í—Å—ñ –∞–≤—Ç–æ—Ä–∏</option>
    </select>
  </div>

  <div id="mods"></div>

  <footer>
    ‚ú® –ß–∞—Å –≤—ñ–¥ —á–∞—Å—É –∑‚Äô—è–≤–ª—è—é—Ç—å—Å—è –Ω–æ–≤—ñ –ø–µ—Ä–µ–∫–ª–∞–¥–∏.<br>
    –Ø–∫—â–æ –Ω–µ –±–∞—á–∏—à –∑–º—ñ–Ω ‚Äî –Ω–∞—Ç–∏—Å–Ω–∏ <b>Ctrl+F5</b>.
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script>
    let allMods = [];
    let theme = "light";

    async function loadMods() {
      const index = await fetch("mods/index.json").then(r => r.json());
      for (const modName of index.mods) {
        await loadMod(modName);
      }
      fillFilters();
      renderMods();
    }

    async function loadMod(modName) {
      const [info, desc, img] = await Promise.all([
        fetch(`mods/${modName}/mod.json`).then(r => r.json()),
        fetch(`mods/${modName}/mod.txt`).then(r => r.text()),
        fetch(`mods/${modName}/image.jpeg`).then(r => r.blob())
      ]);

      const imgUrl = URL.createObjectURL(img);
      info.forEach(modVersion => {
        allMods.push({
          ...modVersion,
          description: desc,
          image: imgUrl,
          modName
        });
      });
    }

    function fillFilters() {
      const versions = [...new Set(allMods.map(m => m.version))];
      const authors = [...new Set(allMods.map(m => m.author))];

      const versionSelect = document.getElementById("versionFilter");
      versions.forEach(v => {
        const opt = document.createElement("option");
        opt.value = v;
        opt.textContent = v;
        versionSelect.appendChild(opt);
      });

      const authorSelect = document.getElementById("authorFilter");
      authors.forEach(a => {
        const opt = document.createElement("option");
        opt.value = a;
        opt.textContent = a;
        authorSelect.appendChild(opt);
      });
    }

    function renderMods() {
      const search = document.getElementById("search").value.toLowerCase();
      const version = document.getElementById("versionFilter").value;
      const author = document.getElementById("authorFilter").value;

      const container = document.getElementById("mods");
      container.innerHTML = "";

      const filtered = allMods.filter(m =>
        m.name.toLowerCase().includes(search) &&
        (!version || m.version === version) &&
        (!author || m.author === author)
      );

      filtered.forEach(mod => {
        const card = document.createElement("div");
        card.className = "mod-card";
        card.innerHTML = `
          <img src="${mod.image}" alt="mod">
          <div class="info">
            <h3>${mod.name}</h3>
            <p>${mod.description}</p>
            <p><b>–í–µ—Ä—Å—ñ—è:</b> ${mod.version} | <b>–ê–≤—Ç–æ—Ä:</b> ${mod.author}</p>
          </div>
          <div class="buttons">
            <button onclick="downloadMod('${mod.link}', '${mod.modName}', '${mod.author}')">‚¨áÔ∏è –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑ –ø–µ—Ä–µ–∫–ª–∞–¥–æ–º</button>
          </div>
        `;
        container.appendChild(card);
      });
    }

    async function downloadMod(link, modName, author) {
      const zip = new JSZip();

      const modFile = await fetch(link).then(r => r.blob());
      zip.file(link.split("/").pop(), modFile);

      const jsonFile = await fetch(`mods/${modName}/Lang/${author}.json`).then(r => r.blob());
      zip.file("ua_uk.json", jsonFile);

      const content = await zip.generateAsync({ type: "blob" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(content);
      a.download = `${modName}_with_translation.zip`;
      a.click();
    }

    function toggleTheme() {
      theme = theme === "light" ? "dark" : "light";
      document.body.className = theme === "dark" ? "dark" : "";
    }

    loadMods();
  </script>
</body>
</html>
