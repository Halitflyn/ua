<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Українські переклади модів</title>
    <link rel="icon" href="data:,">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; color: #333; }
        h1 { text-align: center; }
        #search-container { text-align: center; margin-bottom: 20px; }
        #search-input, select { padding: 10px; font-size: 16px; border: 1px solid #ddd; border-radius: 4px; margin: 0 5px 10px 0; }
        .mod-list { display: flex; flex-wrap: wrap; justify-content: center; }
        .mod-card { background: white; border: 1px solid #ddd; border-radius: 8px; margin: 10px; padding: 15px; width: 220px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .mod-card img { width: 66.67%; height: auto; border-radius: 4px; display: block; margin: 0 auto; }
        .mod-card h2 { margin: 10px 0; }
        .mod-card p { margin: 5px 0; }
        button { background-color: #4CAF50; color: white; border: none; padding: 10px 15px; cursor: pointer; border-radius: 4px; margin-top: 5px; }
        button:hover { background-color: #45a049; }
        .hidden { display: none; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>
<h1>Українські переклади модів (як Modrinth)</h1>
<div id="search-container">
    <input type="text" id="search-input" placeholder="Пошук по назві мода..."><br>
    <select id="filter-version">
        <option value="">Всі версії</option>
    </select>
    <select id="filter-core">
        <option value="">Всі ядра</option>
    </select>
    <select id="filter-author">
        <option value="">Всі автори</option>
    </select>
</div>
<button id="combine-open">Об'єднати мод</button>
<div id="mod-list" class="mod-list"></div>

<!-- Модальні вікна залишаються без змін -->

<script>
const repoOwner = 'halitflyn';
const repoName = 'ua';
const basePath = 'mods';
const rawBaseUrl = `https://raw.githubusercontent.com/${repoOwner}/${repoName}/main`;

// Масиви для фільтрів
let allVersions = new Set();
let allCores = new Set();
let allAuthors = new Set();

async function fetchRepoContents(path) {
    const url = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${path}`;
    try {
        const response = await fetch(url);
        if (!response.ok) return null;
        return await response.json();
    } catch (e) { console.error(`Error fetching contents for ${path}:`, e); return null; }
}

async function loadMods() {
    const mods = await fetchRepoContents(basePath);
    if (!mods || !Array.isArray(mods)) return;
    const modListDiv = document.getElementById('mod-list');

    for (const mod of mods) {
        if (mod.type !== 'dir') continue;
        const modPath = `${basePath}/${mod.name}`;
        const modContents = await fetchRepoContents(modPath);
        if (!modContents || !Array.isArray(modContents)) continue;

        let modJson = null, modTxt = null, imageUrl = null, langFiles = [];

        for (const file of modContents) {
            if (file.name === 'mod.json') {
                try { 
                    const jsonResponse = await fetch(`${rawBaseUrl}/${modPath}/mod.json`);
                    if (jsonResponse.ok) modJson = await jsonResponse.json();
                } catch(e) { console.error(e); }
            } else if (file.name === 'mod.txt') {
                try { const txtResponse = await fetch(`${rawBaseUrl}/${modPath}/mod.txt`); if (txtResponse.ok) modTxt = await txtResponse.text(); } catch(e) {}
            } else if (file.name === 'image.jpeg') { imageUrl = `${rawBaseUrl}/${modPath}/image.jpeg`; }
            else if (file.name === 'lang' && file.type === 'dir') {
                const langPath = `${modPath}/lang`;
                const langContents = await fetchRepoContents(langPath);
                if (langContents) langFiles = langContents.map(f => ({author: f.name.replace('.json',''), url:`${rawBaseUrl}/${langPath}/${f.name}`}));
            }
        }

        if (modJson && modTxt && imageUrl) {
            const [name, description, modrinthLink] = modTxt.trim().split('\n');
            const versionsArr = modJson.map(v => v.version);
            const loadersArr = modJson.map(v => v.loader);
            const authorsArr = modJson.map(v => v.author);

            // Додати у множини для фільтрів
            versionsArr.forEach(v => allVersions.add(v));
            loadersArr.forEach(l => allCores.add(l));
            authorsArr.forEach(a => allAuthors.add(a));

            const card = document.createElement('div');
            card.className = 'mod-card';
            card.dataset.name = name.toLowerCase();
            card.dataset.versions = versionsArr.join(' ').toLowerCase();
            card.dataset.loaders = loadersArr.join(' ').toLowerCase();
            card.dataset.authors = authorsArr.join(' ').toLowerCase();
            card.innerHTML = `
                <img src="${imageUrl}" alt="${name}">
                <h2>${name}</h2>
                <p>${description}</p>
                <p><a href="${modrinthLink}" target="_blank">Modrinth сторінка</a></p>
                <p>Версія: ${versionsArr.join(', ')}</p>
                <p>(${loadersArr.join(' - ')})</p>
            `;
            const selectButton = document.createElement('button');
            selectButton.textContent = 'Вибрати переклад';
            selectButton.addEventListener('click', () => showSelectModal(modJson, langFiles, name));
            card.appendChild(selectButton);
            modListDiv.appendChild(card);
        }
    }

    populateFilterOptions();
}

// Заповнити фільтри
function populateFilterOptions() {
    const vSelect = document.getElementById('filter-version');
    const cSelect = document.getElementById('filter-core');
    const aSelect = document.getElementById('filter-author');

    [...allVersions].sort().forEach(v => { const opt = document.createElement('option'); opt.value = v; opt.textContent = v; vSelect.appendChild(opt); });
    [...allCores].sort().forEach(c => { const opt = document.createElement('option'); opt.value = c; opt.textContent = c; cSelect.appendChild(opt); });
    [...allAuthors].sort().forEach(a => { const opt = document.createElement('option'); opt.value = a; opt.textContent = a; aSelect.appendChild(opt); });
}

// Фільтрація + пошук по назві
function filterMods() {
    const search = document.getElementById('search-input').value.toLowerCase();
    const versionFilter = document.getElementById('filter-version').value.toLowerCase();
    const coreFilter = document.getElementById('filter-core').value.toLowerCase();
    const authorFilter = document.getElementById('filter-author').value.toLowerCase();

    document.querySelectorAll('.mod-card').forEach(card => {
        const name = card.dataset.name;
        const versions = card.dataset.versions;
        const loaders = card.dataset.loaders;
        const authors = card.dataset.authors;

        if (name.includes(search) &&
            (versionFilter === '' || versions.includes(versionFilter)) &&
            (coreFilter === '' || loaders.includes(coreFilter)) &&
            (authorFilter === '' || authors.includes(authorFilter))
        ) { card.classList.remove('hidden'); } else { card.classList.add('hidden'); }
    });
}

loadMods().then(() => {
    document.getElementById('search-input').addEventListener('input', filterMods);
    document.getElementById('filter-version').addEventListener('change', filterMods);
    document.getElementById('filter-core').addEventListener('change', filterMods);
    document.getElementById('filter-author').addEventListener('change', filterMods);
});
</script>
</body>
</html>
